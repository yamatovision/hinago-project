# 地図表示アーキテクチャ分析

## 現在の問題
- APIレスポンスは正常（物件データ取得成功）
- 座標データも正常（ジオコーディング成功）
- しかし地図が表示されない

## 現在のデータフロー

### 1. 物件データ取得
```
✅ API: GET /api/v1/properties/{id} → 物件データ取得成功
✅ データ: address = "南都留郡富士河口湖町小立2253-1"
```

### 2. ジオコーディング
```
✅ API: GET /api/v1/geocode?address={住所} → 座標取得成功
✅ 座標: lat: 31.249212613911006, lng: 131.89712524118443
```

### 3. 地図表示（問題発生箇所）
```
❌ PropertyMap コンポーネント → 地図が表示されない
- APIキー: 存在する
- 座標: 正常
- マーカー: 表示される（地図は灰色）
```

## アーキテクチャの問題点

### 問題1: APIキーの公開露出
- フロントエンドでGoogle Maps APIキーを直接使用
- セキュリティリスク（クライアントサイドで露出）
- 悪用される可能性

### 問題2: 重複処理
- バックエンドでジオコーディング実行
- フロントエンドで地図表示のためにAPIキー使用
- 同じAPIキーで2つの異なる処理

### 問題3: APIクォータの問題
- フロントエンドの地図表示で大量のタイル読み込み
- バックエンドのジオコーディングと合わせて制限に到達する可能性

## 推奨アーキテクチャ

### 案1: サーバーサイド地図レンダリング
```
Backend: 物件データ + 座標 → 静的地図画像生成 → Frontend表示
```

### 案2: プロキシ経由でAPIキー保護
```
Frontend → Backend Proxy → Google Maps API
```

### 案3: 座標データをDBに保存
```
物件登録時: 住所 → ジオコーディング → 座標をDB保存
表示時: DB座標データ → 地図表示（APIキー節約）
```

## 緊急修正案: 座標保存アプローチ
1. 物件データに latitude, longitude フィールド追加
2. 物件保存時にジオコーディング結果を永続化
3. 地図表示時は保存済み座標を使用
4. フロントエンドAPIキー使用量を最小化